name: Secret Validtaion

on:
  workflow_dispatch:

jobs:
  create-instance:
    runs-on: ubuntu-latest

    steps:
      - name: Install OCI CLI
        run: pip install oci-cli

      - name: Setup OCI Config
        run: |
          mkdir -p ~/.oci

          cat > ~/.oci/config << EOF
          [DEFAULT]
          user=${{ secrets.OCI_USER }}
          fingerprint=${{ secrets.OCI_FINGERPRINT }}
          tenancy=${{ secrets.OCI_TENANCY }}
          region=ap-chuncheon-1
          key_file=~/.oci/key.pem
          EOF

          echo '${{ secrets.OCI_KEY }}' > ~/.oci/key.pem
          chmod 600 ~/.oci/config ~/.oci/key.pem

      - name: Debug - Test Connection
        run: |
          echo "=== Testing OCI CLI ==="
          oci iam region list --output table

          echo ""
          echo "=== Tenancy Info ==="
          oci iam tenancy get --tenancy-id ${{ secrets.OCI_TENANCY }} --output table

          echo ""
          echo "=== List Compartments ==="
          oci iam compartment list --compartment-id ${{ secrets.OCI_TENANCY }} --all --output table

          echo ""
          echo "=== Check Subnet ==="
          oci network subnet get --subnet-id ${{ secrets.OCI_SUBNET }} 2>&1 || echo "Subnet access failed"

          echo ""
          echo "=== Check Image ==="
          oci compute image get --image-id ${{ secrets.OCI_IMAGE }} 2>&1 || echo "Image access failed"
